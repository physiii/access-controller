<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Access Controller</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    (function ensureTrailingSlash() {
      var path = window.location.pathname || '';
      if (path && !path.endsWith('/')) {
        var redirect = path + '/' + (window.location.search || '') + (window.location.hash || '');
        window.location.replace(redirect);
      }
    })();
  </script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="app-bar">
    <div class="app-brand">
      <span class="app-title">Access Controller</span>
      <span class="app-subtitle">Device Manager</span>
    </div>
  </header>

  <nav class="nav-tabs" aria-label="Primary navigation">
    <button class="nav-item active" data-target="device" type="button">Device</button>
    <button class="nav-item" data-target="system" type="button">System</button>
    <button class="nav-item" data-target="settings" type="button">Settings</button>
  </nav>

  <main class="page-container">
    <section id="page-device" class="page active" aria-labelledby="device-heading">
      <div class="card">
        <div class="card-header">
          <div>
            <h2 id="device-heading">Relay Channels</h2>
            <p class="subtitle">Control locks, exit buttons, and FOB inputs per channel.</p>
          </div>
        </div>
        <div class="channel-grid">
          <div class="channel-card" data-channel="1">
            <div class="card-section-header">
              <h3>Channel 1</h3>
            </div>
            <div class="control-section">
              <h4>Lock</h4>
              <label class="form-switch">
                <input type="checkbox" id="enableLock_1">
                <span>Enable lock</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="arm_1">
                <span>Arm lock</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="enableContactAlert_1">
                <span>Contact alert</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="polarity_1">
                <span>Reverse polarity</span>
              </label>
            </div>
            <div class="control-section">
              <h4>Exit</h4>
              <label class="form-switch">
                <input type="checkbox" id="enableExit_1">
                <span>Enable exit button</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="alertExit_1">
                <span>Exit button alert</span>
              </label>
              <div class="input-row">
                <label for="armDelay_1">Re-arm delay (seconds)</label>
                <div class="input-group">
                  <input type="number" id="armDelay_1" min="0" step="1" value="5">
                  <button id="relock" type="button" class="secondary">Save</button>
                </div>
              </div>
            </div>
            <div class="control-section">
              <h4>Keypad</h4>
              <label class="form-switch">
                <input type="checkbox" id="enableKeypad_1">
                <span>Enable keypad</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="alertKeypad_1">
                <span>Keypad alert</span>
              </label>
              <div class="input-row">
                <label for="keypadDelay_1">Re-arm delay (seconds)</label>
                <div class="input-group">
                  <input type="number" id="keypadDelay_1" min="0" step="1" value="5">
                  <button id="keypadSave_1" type="button" class="secondary">Save</button>
                </div>
              </div>
            </div>
            <div class="control-section">
              <h4>FOB</h4>
              <label class="form-switch">
                <input type="checkbox" id="enableFob_1">
                <span>Enable FOB button</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="alertFob_1">
                <span>FOB alert</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="latchFob_1">
                <span>FOB latch</span>
              </label>
            </div>
          </div>

          <div class="channel-card" data-channel="2">
            <div class="card-section-header">
              <h3>Channel 2</h3>
            </div>
            <div class="control-section">
              <h4>Lock</h4>
              <label class="form-switch">
                <input type="checkbox" id="enableLock_2">
                <span>Enable lock</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="arm_2">
                <span>Arm lock</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="enableContactAlert_2">
                <span>Contact alert</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="polarity_2">
                <span>Reverse polarity</span>
              </label>
            </div>
            <div class="control-section">
              <h4>Exit</h4>
              <label class="form-switch">
                <input type="checkbox" id="enableExit_2">
                <span>Enable exit button</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="alertExit_2">
                <span>Exit button alert</span>
              </label>
              <div class="input-row">
                <label for="armDelay_2">Re-arm delay (seconds)</label>
                <div class="input-group">
                  <input type="number" id="armDelay_2" min="0" step="1" value="5">
                  <button id="relock_2" type="button" class="secondary">Save</button>
                </div>
              </div>
            </div>
            <div class="control-section">
              <h4>Keypad</h4>
              <label class="form-switch">
                <input type="checkbox" id="enableKeypad_2">
                <span>Enable keypad</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="alertKeypad_2">
                <span>Keypad alert</span>
              </label>
              <div class="input-row">
                <label for="keypadDelay_2">Re-arm delay (seconds)</label>
                <div class="input-group">
                  <input type="number" id="keypadDelay_2" min="0" step="1" value="5">
                  <button id="keypadSave_2" type="button" class="secondary">Save</button>
                </div>
              </div>
            </div>
            <div class="control-section">
              <h4>FOB</h4>
              <label class="form-switch">
                <input type="checkbox" id="enableFob_2">
                <span>Enable FOB button</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="alertFob_2">
                <span>FOB alert</span>
              </label>
              <label class="form-switch">
                <input type="checkbox" id="latchFob_2">
                <span>FOB latch</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="card" id="wiegand-card">
        <div class="card-header">
          <div>
            <h2>RFID Cards</h2>
            <p class="subtitle">Manage registered RFID tags and fobs.</p>
          </div>
          <div class="card-actions">
            <select id="wiegandChannelSelect" aria-label="Wiegand channel">
              <option value="0">All channels</option>
              <option value="1">Channel 1</option>
              <option value="2">Channel 2</option>
            </select>
            <button id="wiegandRegisterBtn" type="button">
              <span class="btn-icon">+</span> Register
            </button>
            <button id="wiegandStopBtn" type="button" class="secondary">Stop</button>
          </div>
        </div>
        <div class="status-bar" id="wiegandStatusBar">
          <div class="status-indicator" id="wiegandStatusIndicator">
            <span class="status-dot"></span>
            <span id="wiegandStatus">Idle</span>
          </div>
          <div class="status-meta">
            <span class="label">Pending:</span>
            <span id="wiegandPending" class="value">0</span>
          </div>
          <div class="status-meta" id="wiegandDuplicateWrap">
            <span class="label">Duplicate:</span>
            <span id="wiegandDuplicate" class="value muted">—</span>
          </div>
        </div>
        <div id="wiegandUserList" class="user-list"></div>
      </div>

      <div class="card" id="rf-card">
        <div class="card-header">
          <div>
            <h2>Remote FOBs</h2>
            <p class="subtitle">Learn 433MHz remotes and manage their names.</p>
          </div>
          <div class="card-actions">
            <button id="rfRegisterBtn" type="button">
              <span class="btn-icon">+</span> Register
            </button>
            <button id="rfStopBtn" type="button" class="secondary">Stop</button>
          </div>
        </div>
        <div class="status-bar" id="rfStatusBar">
          <div class="status-indicator" id="rfStatusIndicator">
            <span class="status-dot"></span>
            <span id="rfStatus">Idle</span>
          </div>
          <div class="status-meta">
            <span class="label">Pending:</span>
            <span id="rfPending" class="value">0</span>
          </div>
          <div class="status-meta" id="rfDuplicateWrap">
            <span class="label">Duplicate:</span>
            <span id="rfDuplicate" class="value muted">—</span>
          </div>
        </div>
        <div id="rfUserList" class="user-list"></div>
      </div>

      <div class="card" id="keypad-card">
        <div class="card-header">
          <div>
            <h2>Keypad PIN Codes</h2>
            <p class="subtitle">Manage PIN codes for keypad access.</p>
          </div>
          <div class="card-actions">
            <button id="keypadAddBtn" type="button">
              <span class="btn-icon">+</span> Add PIN
            </button>
          </div>
        </div>
        <div id="keypadUserList" class="user-list">
          <p class="empty-state muted">No PIN codes configured yet.</p>
        </div>
        <div id="keypadAddForm" class="add-form" hidden>
          <div class="form-row">
            <label class="form-field">
              <span>Name</span>
              <input type="text" id="keypadNewName" placeholder="e.g. John Smith">
            </label>
            <label class="form-field">
              <span>PIN Code</span>
              <input type="text" id="keypadNewPin" placeholder="e.g. 1234" maxlength="6" pattern="[0-9]*" inputmode="numeric">
            </label>
          </div>
          <div class="form-actions">
            <button id="keypadCancelBtn" type="button" class="secondary">Cancel</button>
            <button id="keypadSaveNewBtn" type="button">Save PIN</button>
          </div>
        </div>
      </div>
    </section>

    <section id="page-system" class="page" aria-labelledby="system-heading">
      <div class="card">
        <div class="card-header">
          <div>
            <h2 id="system-heading">System Overview</h2>
            <p class="subtitle">Hardware identity and diagnostics.</p>
          </div>
        </div>
        <div class="info-list">
          <div class="info-row">
            <span class="label">UUID</span>
            <span class="value" id="uuid">—</span>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div>
            <h2>Recent Activity</h2>
            <p class="subtitle">Latest controller events (most recent first).</p>
          </div>
        </div>
        <div id="systemLogs" class="log-list">
          <p class="muted" id="logEmptyState">No activity recorded yet.</p>
          <ul id="logItems" class="log-items" hidden></ul>
        </div>
      </div>
    </section>

    <section id="page-settings" class="page" aria-labelledby="settings-heading">
      <div class="card">
        <div class="card-header">
          <div>
            <h2 id="settings-heading">Wi-Fi Settings</h2>
            <p class="subtitle">Update network credentials for station mode.</p>
          </div>
        </div>
        <form id="wifiForm" class="form">
          <label class="form-field">
            <span>Wi-Fi name (SSID)</span>
            <input type="text" id="wifiName" placeholder="Network name">
          </label>
          <label class="form-field">
            <span>Password</span>
            <input type="password" id="wifiPassword" placeholder="Password">
          </label>
          <div class="form-actions">
            <button type="submit">Save Wi-Fi</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="card-header">
          <div>
            <h2>Server Settings</h2>
            <p class="subtitle">Define upstream controller IP and port.</p>
          </div>
        </div>
        <form id="serverForm" class="form">
          <label class="form-field">
            <span>Server IP</span>
            <input type="text" id="ipAddress" placeholder="192.168.1.100">
          </label>
          <label class="form-field">
            <span>Server port</span>
            <input type="text" id="port" placeholder="9000">
          </label>
          <div class="form-actions">
            <button type="submit">Save Server</button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite" hidden></div>

  <script src="script.js"></script>
</body>
</html>
